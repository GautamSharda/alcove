{% extends 'layout.njk' %}

{% block content %}
<div>
  <div class="ui fluid stackable grid" id="dashboard-header-grid">
    <div class="row">
      <div class="left floated left aligned six wide column">
        <a href="/dashboard"><img src="/logo.png" alt="Alcove Backup System logo" id="dashboard-logo"></a>
      </div>
      <div class="right floated right aligned ten wide column">
        <div class="ui statistics" id="dashboard-header-stats-container">
          <div class="green statistic">
            <div class="value">
              {{ successfulMachines }}
            </div>
            <div class="label">
              All Backups
            </div>
          </div><div class="yellow statistic">
            <div class="value">
              {{ partiallySuccessfulMachines }}
            </div>
            <div class="label">
              Some Backups
            </div>
          </div><div class="red statistic">
            <div class="value">
              {{ unsuccessfulMachines }}
            </div>
            <div class="label">
              No Backups
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="three column row">
      <div class="column">
        <div class="ui segment dashboard-header-segment">
          Total backup size: <br><span class="bold" id="totalSize">...</span>
        </div>
      </div>
      <div class="column">
        <div class="ui segment dashboard-header-segment">
          Free space: <br><span class="bold" id="freeSpace">...</span>
        </div>
      </div>
      <div class="column">
        <div class="ui segment dashboard-header-segment">
          Running since: <br><span class="bold">{{ lastBackupSystemRestart }}</span>
        </div>
      </div>
    </div>

    <div class="one column row">
      <div class="column">
        <table class="ui striped selectable sortable celled table">
          <thead>
            <tr>
              <th>Machine Name</th>
              <th class="eight wide">Status</th>
              <th>Total Size</th>
              <th>Last Backup</th>
            </tr>
          </thead>
          <tbody>
          {% for machine in machines %}
            <tr>
              <td class="selectable">
                <a href="/machine/{{ machine.name }}" class="bold"> {{ machine.name }} </a>
              </td>
              <!--Spacing is very important- please do not change it.-->
              {% if machine.scheduledBackups == 0 %}
                <td>
                  <i class="minus icon"></i>
                  {{ machine.successfulBackups }} of {{ machine.scheduledBackups }} backups successful
                </td>
              {% elif machine.scheduledBackups == machine.successfulBackups %}
                <td class="positive">
                  <i class="check icon"></i>
                  {{ machine.successfulBackups }} of {{ machine.scheduledBackups }} backups successful
                </td>
              {% elif machine.successfulBackups == 0 %}
                <td class="negative">
                  <i class="exclamation circle icon"></i>
                  {{ machine.successfulBackups }} of {{ machine.scheduledBackups }} backups successful
                </td>
              {% else %}
                <td class="warning">
                  <i class="exclamation triangle icon"></i>
                  {{ machine.successfulBackups }} of {{ machine.scheduledBackups }} backups successful
                </td>
              {% endif %}
              <td>...</td>
              <td>{{ machine.timeSinceLastBackup }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
  <script src="/js/vendor/jquery.tablesort.min.js"></script>
  <script src="/js/dashboard.js"></script>
  <script class="text/javascript"> $('table').tablesort(); </script>
{% endblock %}
