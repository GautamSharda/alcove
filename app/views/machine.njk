{% extends 'layout.njk' %}

{% block content %}
  <div class="dashboard-body">
    <div class="ui fluid stackable grid" id="dashboard-header-grid">
      <div class="row" id="dashboard-header-row-top">
        <div class="six wide column">
          <a href="/dashboard"><img id="logo" src="/logo.png"></a>
          <h1>Machine: {{ machine.name }}</h1>
          <h1></h1>
        </div>
        <div class="ten wide column">
          <table class="ui celled unstackable table">
            <thead>
              <tr>
                <th>Sa</th>
                <th>M</th>
                <th>Tu</th>
                <th>W</th>
                <th>Th</th>
                <th>F</th>
                <th>Su</th>
              </tr>
            </thead>
            <tbody>
              {% for week in backupCalendar %}
                <tr>
                  {% for day in week %}
                    <td class="
                      {{ 'disabled' if not day.bucket and not day.id}}
                      {{ 'today-td-border' if day.today }}
                      {{ 'positive' if day.bucket and day.successfulBackups > 0 }}
                      {{ 'negative' if day.bucket and day.successfulBackups === 0 }}
                      {{ 'warning' if not day.bucket and day.attemptedBackups > 0 }}
                      {{ 'selectable' if day.id }}
                    ">
                      {% if day.id %}
                        <a href="#backupevent-{{ day.id }}">{{ day.dateString }}</a>
                      {% else %}
                        {{ day.dateString }}
                      {% endif %}
                    </td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

{#      <div class="three column row">#}
{#        <div class="column">#}
{#          <div class="ui segment" id="dashboard-header-segment">#}
{#            Total Backup Size: <br /> <span class="dashboard-bold" id="totalSize">...</span>#}
{#          </div>#}
{#        </div>#}
{#        <div class="column">#}
{#          <div class="ui segment" id="dashboard-header-segment">#}
{#            Free Space: <br /> <span class="dashboard-bold" id="freeSpace">...</span>#}
{#          </div>#}
{#        </div>#}
{#        <div class="column">#}
{#          <div class="ui segment" id="dashboard-header-segment">#}
{#            Running since: <br /> <span class="dashboard-bold"> {{ lastBackupSystemRestart }} </span>#}
{#          </div>#}
{#        </div>#}
{#      </div>#}
    </div>

    <table class="ui striped selectable sortable celled table" id="dashboard-table">
      <thead>
      <tr>
        <th class="collapsing">Backup Time</th>
        <th class="collapsing">Transfer Size</th>
        <th class="collapsing">Transfer Time</th>
        <th class="collapsing">Exit Code</th>
        <th>Rsync Exit Reason</th>
      </tr>
      </thead>
      <tbody>
        {% for backupEvent in backupEvents %}
          <tr id="backupevent-{{ backupEvent.id }}">
            {% if backupEvent.rsyncExitCode %}
              <td class="collapsing negative"><i class="exclamation triangle icon"></i>{{ backupEvent.backupTime }}</td>
            {% else %}
              <td class="collapsing positive"><i class="check circle icon"></i>{{ backupEvent.backupTime }}</td>
            {% endif %}
            <td class="collapsing">{{ backupEvent.transferSizeStr }}</td>
            <td class="collapsing">{{ backupEvent.transferTimeStr }}</td>
            <td class="collapsing">{{ backupEvent.rsyncExitCode }}</td>
            <td>{{ backupEvent.rsyncExitReason }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}

{% block js %}
  <script src="/js/vendor/jquery.tablesort.min.js"></script>
  <script src="/js/machine.js"></script>
{% endblock %}
